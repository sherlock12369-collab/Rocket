{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/coding/rocket/lib/mongodb.ts"],"sourcesContent":["import mongoose from 'mongoose';\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI;\r\n\r\nif (!MONGODB_URI) {\r\n  throw new Error(\r\n    'Please define the MONGODB_URI environment variable inside .env.local'\r\n  );\r\n}\r\n\r\n/**\r\n * Global is used here to maintain a cached connection across hot reloads\r\n * in development. This prevents connections growing exponentially\r\n * during API Route usage.\r\n */\r\ninterface MongooseCache {\r\n  conn: typeof mongoose | null;\r\n  promise: Promise<typeof mongoose> | null;\r\n}\r\n\r\ndeclare global {\r\n  // eslint-disable-next-line no-var\r\n  var mongoose: MongooseCache | undefined;\r\n}\r\n\r\nlet cached: MongooseCache = global.mongoose || { conn: null, promise: null };\r\n\r\nif (!cached) {\r\n  cached = global.mongoose = { conn: null, promise: null };\r\n}\r\n\r\nasync function dbConnect() {\r\n  if (cached.conn) {\r\n    return cached.conn;\r\n  }\r\n\r\n  if (!cached.promise) {\r\n    const opts = {\r\n      bufferCommands: false,\r\n    };\r\n\r\n    cached.promise = mongoose.connect(MONGODB_URI!, opts).then((mongoose) => {\r\n      return mongoose;\r\n    });\r\n  }\r\n\r\n  try {\r\n    cached.conn = await cached.promise;\r\n  } catch (e) {\r\n    cached.promise = null;\r\n    throw e;\r\n  }\r\n\r\n  return cached.conn;\r\n}\r\n\r\nexport default dbConnect;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAE3C,IAAI,CAAC,aAAa;IAChB,MAAM,IAAI,MACR;AAEJ;AAiBA,IAAI,SAAwB,OAAO,QAAQ,IAAI;IAAE,MAAM;IAAM,SAAS;AAAK;AAE3E,IAAI,CAAC,QAAQ;IACX,SAAS,OAAO,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AACzD;AAEA,eAAe;IACb,IAAI,OAAO,IAAI,EAAE;QACf,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;QAClB;QAEA,OAAO,OAAO,GAAG,mKAAQ,CAAC,OAAO,CAAC,aAAc,MAAM,IAAI,CAAC,CAAC;YAC1D,OAAO;QACT;IACF;IAEA,IAAI;QACF,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACpC,EAAE,OAAO,GAAG;QACV,OAAO,OAAO,GAAG;QACjB,MAAM;IACR;IAEA,OAAO,OAAO,IAAI;AACpB;uCAEe"}},
    {"offset": {"line": 91, "column": 0}, "map": {"version":3,"sources":["file:///C:/coding/rocket/models/Order.ts"],"sourcesContent":["import mongoose from 'mongoose';\r\n\r\nconst OrderItemSchema = new mongoose.Schema({\r\n    productId: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: 'Product',\r\n        required: true,\r\n    },\r\n    title: { type: String, required: true }, // Snapshot of product title\r\n    price: { type: Number, required: true }, // Snapshot of price at purchase\r\n    quantity: { type: Number, default: 1 },\r\n    type: { type: String, enum: ['buy', 'rent'], required: true },\r\n});\r\n\r\nconst OrderSchema = new mongoose.Schema({\r\n    userId: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: 'User',\r\n        required: true,\r\n    },\r\n    items: [OrderItemSchema],\r\n    shippingFee: {\r\n        type: Number,\r\n        required: true,\r\n        default: 0,\r\n    },\r\n    totalPrice: {\r\n        type: Number,\r\n        required: true,\r\n    },\r\n    status: {\r\n        type: String,\r\n        enum: ['pending', 'approved', 'fulfilled', 'rejected', 'returned'], // returned for rent items\r\n        default: 'pending',\r\n    },\r\n}, { timestamps: true });\r\n\r\nexport default mongoose.models.Order || mongoose.model('Order', OrderSchema);\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB,IAAI,mKAAQ,CAAC,MAAM,CAAC;IACxC,WAAW;QACP,MAAM,mKAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;QACpC,KAAK;QACL,UAAU;IACd;IACA,OAAO;QAAE,MAAM;QAAQ,UAAU;IAAK;IACtC,OAAO;QAAE,MAAM;QAAQ,UAAU;IAAK;IACtC,UAAU;QAAE,MAAM;QAAQ,SAAS;IAAE;IACrC,MAAM;QAAE,MAAM;QAAQ,MAAM;YAAC;YAAO;SAAO;QAAE,UAAU;IAAK;AAChE;AAEA,MAAM,cAAc,IAAI,mKAAQ,CAAC,MAAM,CAAC;IACpC,QAAQ;QACJ,MAAM,mKAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;QACpC,KAAK;QACL,UAAU;IACd;IACA,OAAO;QAAC;KAAgB;IACxB,aAAa;QACT,MAAM;QACN,UAAU;QACV,SAAS;IACb;IACA,YAAY;QACR,MAAM;QACN,UAAU;IACd;IACA,QAAQ;QACJ,MAAM;QACN,MAAM;YAAC;YAAW;YAAY;YAAa;YAAY;SAAW;QAClE,SAAS;IACb;AACJ,GAAG;IAAE,YAAY;AAAK;uCAEP,mKAAQ,CAAC,MAAM,CAAC,KAAK,IAAI,mKAAQ,CAAC,KAAK,CAAC,SAAS"}},
    {"offset": {"line": 161, "column": 0}, "map": {"version":3,"sources":["file:///C:/coding/rocket/models/Product.ts"],"sourcesContent":["import mongoose from 'mongoose';\r\n\r\nconst ProductSchema = new mongoose.Schema({\r\n    title: {\r\n        type: String,\r\n        required: [true, 'Please provide a product title.'],\r\n        maxlength: [50, 'Title cannot be more than 50 characters'],\r\n    },\r\n    description: {\r\n        type: String,\r\n        default: '',\r\n    },\r\n    price: {\r\n        type: Number,\r\n        required: [true, 'Please provide a price (points).'],\r\n        min: 0,\r\n    },\r\n    image: {\r\n        type: String,\r\n        default: '/images/boilerplate-product.png', // 기본 이미지 경로\r\n    },\r\n    stock: {\r\n        type: Number,\r\n        default: 1,\r\n        min: 0,\r\n    },\r\n    category: {\r\n        type: String,\r\n        required: [true, 'Please specify a category.'], // e.g., 'Toy', 'Snack', 'Coupon'\r\n    },\r\n    type: {\r\n        type: String,\r\n        enum: ['buy', 'rent'],\r\n        default: 'buy',\r\n    },\r\n}, { timestamps: true });\r\n\r\nexport default mongoose.models.Product || mongoose.model('Product', ProductSchema);\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,gBAAgB,IAAI,mKAAQ,CAAC,MAAM,CAAC;IACtC,OAAO;QACH,MAAM;QACN,UAAU;YAAC;YAAM;SAAkC;QACnD,WAAW;YAAC;YAAI;SAA0C;IAC9D;IACA,aAAa;QACT,MAAM;QACN,SAAS;IACb;IACA,OAAO;QACH,MAAM;QACN,UAAU;YAAC;YAAM;SAAmC;QACpD,KAAK;IACT;IACA,OAAO;QACH,MAAM;QACN,SAAS;IACb;IACA,OAAO;QACH,MAAM;QACN,SAAS;QACT,KAAK;IACT;IACA,UAAU;QACN,MAAM;QACN,UAAU;YAAC;YAAM;SAA6B;IAClD;IACA,MAAM;QACF,MAAM;QACN,MAAM;YAAC;YAAO;SAAO;QACrB,SAAS;IACb;AACJ,GAAG;IAAE,YAAY;AAAK;uCAEP,mKAAQ,CAAC,MAAM,CAAC,OAAO,IAAI,mKAAQ,CAAC,KAAK,CAAC,WAAW"}},
    {"offset": {"line": 223, "column": 0}, "map": {"version":3,"sources":["file:///C:/coding/rocket/models/User.ts"],"sourcesContent":["import mongoose from 'mongoose';\r\n\r\nconst UserSchema = new mongoose.Schema({\r\n    username: {\r\n        type: String,\r\n        required: [true, 'Please provide a username.'],\r\n        unique: true,\r\n        maxlength: [20, 'Username cannot be more than 20 characters'],\r\n    },\r\n    password: {\r\n        type: String,\r\n        required: [true, 'Please provide a password.'],\r\n    },\r\n    name: {\r\n        type: String,\r\n        required: [true, 'Please provide a name.'],\r\n        maxlength: [20, 'Name cannot be more than 20 characters'],\r\n    },\r\n    role: {\r\n        type: String,\r\n        enum: ['admin', 'user'],\r\n        default: 'user',\r\n    },\r\n    pointBalance: {\r\n        type: Number,\r\n        default: 0,\r\n    },\r\n    avatar: {\r\n        type: String, // URL or predefined avatar id\r\n        default: '/avatars/default.png',\r\n    },\r\n}, { timestamps: true });\r\n\r\nexport default mongoose.models.User || mongoose.model('User', UserSchema);\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,aAAa,IAAI,mKAAQ,CAAC,MAAM,CAAC;IACnC,UAAU;QACN,MAAM;QACN,UAAU;YAAC;YAAM;SAA6B;QAC9C,QAAQ;QACR,WAAW;YAAC;YAAI;SAA6C;IACjE;IACA,UAAU;QACN,MAAM;QACN,UAAU;YAAC;YAAM;SAA6B;IAClD;IACA,MAAM;QACF,MAAM;QACN,UAAU;YAAC;YAAM;SAAyB;QAC1C,WAAW;YAAC;YAAI;SAAyC;IAC7D;IACA,MAAM;QACF,MAAM;QACN,MAAM;YAAC;YAAS;SAAO;QACvB,SAAS;IACb;IACA,cAAc;QACV,MAAM;QACN,SAAS;IACb;IACA,QAAQ;QACJ,MAAM;QACN,SAAS;IACb;AACJ,GAAG;IAAE,YAAY;AAAK;uCAEP,mKAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,mKAAQ,CAAC,KAAK,CAAC,QAAQ"}},
    {"offset": {"line": 344, "column": 0}, "map": {"version":3,"sources":["file:///C:/coding/rocket/app/api/auth/%5B...nextauth%5D/route.ts"],"sourcesContent":["import NextAuth, { NextAuthOptions } from \"next-auth\";\r\nimport CredentialsProvider from \"next-auth/providers/credentials\";\r\nimport dbConnect from \"@/lib/mongodb\";\r\nimport User from \"@/models/User\";\r\nimport bcrypt from \"bcryptjs\";\r\n\r\nexport const authOptions: NextAuthOptions = {\r\n    providers: [\r\n        CredentialsProvider({\r\n            name: \"Credentials\",\r\n            credentials: {\r\n                username: { label: \"Username\", type: \"text\" },\r\n                password: { label: \"Password\", type: \"password\" },\r\n            },\r\n            async authorize(credentials) {\r\n                if (!credentials?.username || !credentials?.password) {\r\n                    throw new Error(\"Please enter an username and password\");\r\n                }\r\n\r\n                await dbConnect();\r\n\r\n                const user = await User.findOne({ username: credentials.username });\r\n\r\n                if (!user) {\r\n                    throw new Error(\"No user found\");\r\n                }\r\n\r\n                const isPasswordCorrect = await bcrypt.compare(\r\n                    credentials.password,\r\n                    user.password\r\n                );\r\n\r\n                if (!isPasswordCorrect) {\r\n                    throw new Error(\"Incorrect Password\");\r\n                }\r\n\r\n                return {\r\n                    id: user._id.toString(),\r\n                    name: user.name,\r\n                    email: user.username, // Using username as email for NextAuth compatibility\r\n                    image: user.avatar,\r\n                    role: user.role,\r\n                };\r\n            },\r\n        }),\r\n    ],\r\n    callbacks: {\r\n        async jwt({ token, user, trigger, session }) {\r\n            if (user) {\r\n                token.id = user.id;\r\n                token.role = (user as any).role;\r\n                token.picture = user.image;\r\n            }\r\n\r\n            // Update session triggering\r\n            if (trigger === \"update\" && session) {\r\n                token = { ...token, ...session };\r\n            }\r\n\r\n            return token;\r\n        },\r\n        async session({ session, token }) {\r\n            if (token) {\r\n                session.user.id = token.id as string;\r\n                session.user.role = token.role as string;\r\n                session.user.image = token.picture;\r\n            }\r\n            return session;\r\n        },\r\n    },\r\n    pages: {\r\n        signIn: \"/auth/login\",\r\n    },\r\n    session: {\r\n        strategy: \"jwt\",\r\n    },\r\n    secret: process.env.NEXTAUTH_SECRET,\r\n};\r\n\r\nconst handler = NextAuth(authOptions);\r\n\r\nexport { handler as GET, handler as POST };\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AACA;AACA;AACA;;;;;;AAEO,MAAM,cAA+B;IACxC,WAAW;QACP,IAAA,qKAAmB,EAAC;YAChB,MAAM;YACN,aAAa;gBACT,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAO;gBAC5C,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YACpD;YACA,MAAM,WAAU,WAAW;gBACvB,IAAI,CAAC,aAAa,YAAY,CAAC,aAAa,UAAU;oBAClD,MAAM,IAAI,MAAM;gBACpB;gBAEA,MAAM,IAAA,2HAAS;gBAEf,MAAM,OAAO,MAAM,2HAAI,CAAC,OAAO,CAAC;oBAAE,UAAU,YAAY,QAAQ;gBAAC;gBAEjE,IAAI,CAAC,MAAM;oBACP,MAAM,IAAI,MAAM;gBACpB;gBAEA,MAAM,oBAAoB,MAAM,8IAAM,CAAC,OAAO,CAC1C,YAAY,QAAQ,EACpB,KAAK,QAAQ;gBAGjB,IAAI,CAAC,mBAAmB;oBACpB,MAAM,IAAI,MAAM;gBACpB;gBAEA,OAAO;oBACH,IAAI,KAAK,GAAG,CAAC,QAAQ;oBACrB,MAAM,KAAK,IAAI;oBACf,OAAO,KAAK,QAAQ;oBACpB,OAAO,KAAK,MAAM;oBAClB,MAAM,KAAK,IAAI;gBACnB;YACJ;QACJ;KACH;IACD,WAAW;QACP,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE;YACvC,IAAI,MAAM;gBACN,MAAM,EAAE,GAAG,KAAK,EAAE;gBAClB,MAAM,IAAI,GAAG,AAAC,KAAa,IAAI;gBAC/B,MAAM,OAAO,GAAG,KAAK,KAAK;YAC9B;YAEA,4BAA4B;YAC5B,IAAI,YAAY,YAAY,SAAS;gBACjC,QAAQ;oBAAE,GAAG,KAAK;oBAAE,GAAG,OAAO;gBAAC;YACnC;YAEA,OAAO;QACX;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC5B,IAAI,OAAO;gBACP,QAAQ,IAAI,CAAC,EAAE,GAAG,MAAM,EAAE;gBAC1B,QAAQ,IAAI,CAAC,IAAI,GAAG,MAAM,IAAI;gBAC9B,QAAQ,IAAI,CAAC,KAAK,GAAG,MAAM,OAAO;YACtC;YACA,OAAO;QACX;IACJ;IACA,OAAO;QACH,QAAQ;IACZ;IACA,SAAS;QACL,UAAU;IACd;IACA,QAAQ,QAAQ,GAAG,CAAC,eAAe;AACvC;AAEA,MAAM,UAAU,IAAA,kJAAQ,EAAC"}},
    {"offset": {"line": 440, "column": 0}, "map": {"version":3,"sources":["file:///C:/coding/rocket/app/api/orders/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport dbConnect from '@/lib/mongodb';\r\nimport Order from '@/models/Order';\r\nimport Product from '@/models/Product';\r\nimport User from '@/models/User';\r\nimport { getServerSession } from 'next-auth';\r\nimport { authOptions } from '../auth/[...nextauth]/route';\r\n\r\nexport async function POST(req: Request) {\r\n    const session = await getServerSession(authOptions);\r\n\r\n    if (!session) {\r\n        return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    await dbConnect();\r\n\r\n    try {\r\n        const { items, shippingFee, totalPrice } = await req.json();\r\n\r\n        // 1. Validate User Points\r\n        const user = await User.findById(session.user.id);\r\n        if (!user) {\r\n            return NextResponse.json({ error: 'User not found' }, { status: 404 });\r\n        }\r\n\r\n        if (user.pointBalance < totalPrice) {\r\n            return NextResponse.json({ error: '포인트가 부족합니다.' }, { status: 400 });\r\n        }\r\n\r\n        // 2. Validate Stock and Prepare Order Items\r\n        for (const item of items) {\r\n            const product = await Product.findById(item.productId);\r\n            if (!product) {\r\n                throw new Error(`상품을 찾을 수 없습니다: ${item.title}`);\r\n            }\r\n            if (product.stock < item.quantity) {\r\n                throw new Error(`재고가 부족합니다: ${item.title}`);\r\n            }\r\n        }\r\n\r\n        // 3. Process Transaction (Simplified for standalone MongoDB)\r\n        // Decrease Stock\r\n        for (const item of items) {\r\n            await Product.findByIdAndUpdate(item.productId, { $inc: { stock: -item.quantity } });\r\n        }\r\n\r\n        // Deduct Points\r\n        await User.findByIdAndUpdate(session.user.id, { $inc: { pointBalance: -totalPrice } });\r\n\r\n        // Create Order\r\n        const order = await Order.create({\r\n            userId: session.user.id,\r\n            items,\r\n            shippingFee,\r\n            totalPrice,\r\n            status: 'pending',\r\n        });\r\n\r\n        return NextResponse.json(order, { status: 201 });\r\n    } catch (error: any) {\r\n        return NextResponse.json({ error: error.message }, { status: 400 });\r\n    }\r\n}\r\n\r\n// Get User Orders\r\nexport async function GET(req: Request) {\r\n    const session = await getServerSession(authOptions);\r\n\r\n    if (!session) {\r\n        return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    await dbConnect();\r\n\r\n    try {\r\n        const orders = await Order.find({ userId: session.user.id }).sort({ createdAt: -1 });\r\n        return NextResponse.json(orders);\r\n    } catch (error: any) {\r\n        return NextResponse.json({ error: error.message }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AAEO,eAAe,KAAK,GAAY;IACnC,MAAM,UAAU,MAAM,IAAA,2JAAgB,EAAC,kKAAW;IAElD,IAAI,CAAC,SAAS;QACV,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACtE;IAEA,MAAM,IAAA,2HAAS;IAEf,IAAI;QACA,MAAM,EAAE,KAAK,EAAE,WAAW,EAAE,UAAU,EAAE,GAAG,MAAM,IAAI,IAAI;QAEzD,0BAA0B;QAC1B,MAAM,OAAO,MAAM,2HAAI,CAAC,QAAQ,CAAC,QAAQ,IAAI,CAAC,EAAE;QAChD,IAAI,CAAC,MAAM;YACP,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,IAAI,KAAK,YAAY,GAAG,YAAY;YAChC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAc,GAAG;gBAAE,QAAQ;YAAI;QACrE;QAEA,4CAA4C;QAC5C,KAAK,MAAM,QAAQ,MAAO;YACtB,MAAM,UAAU,MAAM,8HAAO,CAAC,QAAQ,CAAC,KAAK,SAAS;YACrD,IAAI,CAAC,SAAS;gBACV,MAAM,IAAI,MAAM,CAAC,eAAe,EAAE,KAAK,KAAK,EAAE;YAClD;YACA,IAAI,QAAQ,KAAK,GAAG,KAAK,QAAQ,EAAE;gBAC/B,MAAM,IAAI,MAAM,CAAC,WAAW,EAAE,KAAK,KAAK,EAAE;YAC9C;QACJ;QAEA,6DAA6D;QAC7D,iBAAiB;QACjB,KAAK,MAAM,QAAQ,MAAO;YACtB,MAAM,8HAAO,CAAC,iBAAiB,CAAC,KAAK,SAAS,EAAE;gBAAE,MAAM;oBAAE,OAAO,CAAC,KAAK,QAAQ;gBAAC;YAAE;QACtF;QAEA,gBAAgB;QAChB,MAAM,2HAAI,CAAC,iBAAiB,CAAC,QAAQ,IAAI,CAAC,EAAE,EAAE;YAAE,MAAM;gBAAE,cAAc,CAAC;YAAW;QAAE;QAEpF,eAAe;QACf,MAAM,QAAQ,MAAM,4HAAK,CAAC,MAAM,CAAC;YAC7B,QAAQ,QAAQ,IAAI,CAAC,EAAE;YACvB;YACA;YACA;YACA,QAAQ;QACZ;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC,OAAO;YAAE,QAAQ;QAAI;IAClD,EAAE,OAAO,OAAY;QACjB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACrE;AACJ;AAGO,eAAe,IAAI,GAAY;IAClC,MAAM,UAAU,MAAM,IAAA,2JAAgB,EAAC,kKAAW;IAElD,IAAI,CAAC,SAAS;QACV,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACtE;IAEA,MAAM,IAAA,2HAAS;IAEf,IAAI;QACA,MAAM,SAAS,MAAM,4HAAK,CAAC,IAAI,CAAC;YAAE,QAAQ,QAAQ,IAAI,CAAC,EAAE;QAAC,GAAG,IAAI,CAAC;YAAE,WAAW,CAAC;QAAE;QAClF,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC7B,EAAE,OAAO,OAAY;QACjB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACrE;AACJ"}}]
}